!function(){"use strict";function t(t){return[Math.round(t[0]),Math.round(t[1])]}function s(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function e(t,s,e=1){return[t[0]+s[0]*e,t[1]+s[1]*e]}function i(t,e){return s(e?[t[0]-e[0],t[1]-e[1]]:t)}function a(t,s){let e=t.reduce((t,e,i)=>{let a=s(e);return a<t[1]?[i,a]:t},[-1,1e9]);return e[0]<0?{ind:-1,item:null,val:null}:{ind:e[0],item:t[e[0]],val:s(t[e[0]])}}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var h,n=(function(t){function s(){this.setSettings=function(t){for(var s=0;s<24;s++)this[String.fromCharCode(97+s)]=t[s]||0;this.c<.01&&(this.c=.01);var e=this.b+this.c+this.e;if(e<.18){var i=.18/e;this.b*=i,this.c*=i,this.e*=i}}}var e=new function(){var t,e,i,a,h,n,r,o,l,d,c,f;this._params=new s,this.reset=function(){var t=this._params;a=100/(t.f*t.f+.001),h=100/(t.g*t.g+.001),n=1-t.h*t.h*t.h*.01,r=-t.i*t.i*t.i*1e-6,t.a||(c=.5-t.n/2,f=5e-5*-t.o),o=1+t.l*t.l*(t.l>0?-.9:10),l=0,d=1==t.m?0:(1-t.m)*(1-t.m)*2e4+32},this.totalReset=function(){this.reset();var s=this._params;return t=s.b*s.b*1e5,e=s.c*s.c*1e5,i=s.e*s.e*1e5+12,3*((t+e+i)/3|0)},this.synthWave=function(s,g){var u=this._params,m=1!=u.s||u.v,w=u.v*u.v*.1,p=1+3e-4*u.w,v=u.s*u.s*u.s*.1,b=1+1e-4*u.t,y=1!=u.s,x=u.x*u.x,M=u.g,k=u.q||u.r,L=u.r*u.r*u.r*.2,A=u.q*u.q*(u.q<0?-1020:1020),S=u.p?32+((1-u.p)*(1-u.p)*2e4|0):0,C=u.d,I=u.j/2,R=u.k*u.k*.01,q=u.a,P=t,W=1/t,$=1/e,T=1/i,B=5/(1+u.u*u.u*20)*(.01+v);B>.8&&(B=.8),B=1-B;for(var E,F,_,j,D,U,O=!1,H=0,X=0,Y=0,z=0,G=0,J=0,K=0,N=0,Q=0,V=0,Z=new Array(1024),tt=new Array(32),st=Z.length;st--;)Z[st]=0;for(st=tt.length;st--;)tt[st]=2*Math.random()-1;for(st=0;st<g;st++){if(O)return st;if(S&&++Q>=S&&(Q=0,this.reset()),d&&++l>=d&&(d=0,a*=o),(a*=n+=r)>h&&(a=h,M>0&&(O=!0)),F=a,I>0&&(V+=R,F*=1+Math.sin(V)*I),(F|=0)<8&&(F=8),q||((c+=f)<0?c=0:c>.5&&(c=.5)),++X>P)switch(X=0,++H){case 1:P=e;break;case 2:P=i}switch(H){case 0:Y=X*W;break;case 1:Y=1+2*(1-X*$)*C;break;case 2:Y=1-X*T;break;case 3:Y=0,O=!0}k&&((_=0|(A+=L))<0?_=-_:_>1023&&(_=1023)),m&&p&&((w*=p)<1e-5?w=1e-5:w>.1&&(w=.1)),U=0;for(var et=8;et--;){if(++K>=F&&(K%=F,3==q))for(var it=tt.length;it--;)tt[it]=2*Math.random()-1;switch(q){case 0:D=K/F<c?.5:-.5;break;case 1:D=1-K/F*2;break;case 2:D=.225*(((D=1.27323954*(j=6.28318531*((j=K/F)>.5?j-1:j))+.405284735*j*j*(j<0?1:-1))<0?-1:1)*D*D-D)+D;break;case 3:D=tt[Math.abs(32*K/F|0)]}m&&(E=J,(v*=b)<0?v=0:v>.1&&(v=.1),y?(G+=(D-J)*v,G*=B):(J=D,G=0),z+=(J+=G)-E,D=z*=1-w),k&&(Z[N%1024]=D,D+=Z[(N-_+1024)%1024],N++),U+=D}U*=.125*Y*x,s[st]=U>=1?32767:U<=-1?-32768:32767*U|0}return g}},i=function(t){e._params.setSettings(t);var s=e.totalReset(),i=new Uint8Array(4*((s+1)/2|0)+44),a=2*e.synthWave(new Uint16Array(i.buffer,44),s),h=new Uint32Array(i.buffer,0,44);h[0]=1179011410,h[1]=a+36,h[2]=1163280727,h[3]=544501094,h[4]=16,h[5]=65537,h[6]=44100,h[7]=88200,h[8]=1048578,h[9]=1635017060,h[10]=a,a+=44;for(var n=0,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o="data:audio/wav;base64,";n<a;n+=3){var l=i[n]<<16|i[n+1]<<8|i[n+2];o+=r[l>>18]+r[l>>12&63]+r[l>>6&63]+r[63&l]}return o};t.exports=i}(h={exports:{}},h.exports),h.exports);function r(t){var s=n(t),e=new Audio;e.src=s,e.play()}new AudioContext;function o(t){r([3,,.0315,,.1484,.496,,-.5938,,,,,,,,,,,1,,,.2325,,.5])}class l{}const d=100;class c{constructor(t,s){this.game=t,this.life=0,this.particles=[];for(let t=0;t<30;t++){let e=new l;this.particles.push(e),e.at=[s[0],s[1]];let i=t/30*Math.PI*2+.1*Math.random(),a=Math.random();e.speed=[Math.cos(i)*a,Math.sin(i)*a]}r([3,,.1238,.3385,.3229,.0203,,.0284,,,,,,,,,.4758,-.0269,1,,,,,.5]),t.sfx.push(this)}move(){for(let t of this.particles)t.at=e(t.at,t.speed);return this.life++,this.life<=d}draw(){let t=this.game.ctb;t.lineWidth=2,t.fillStyle=`rgba(255, 0, 0, ${1-this.life/d})`;for(let s of this.particles)t.fillRect(s.at[0],s.at[1],4,4)}}class f{constructor(t,s){this.game=t,this.radius=10,Object.assign(this,s)}draw(){let t=this.game.ctx;t.strokeStyle="#ff0000",t.fillStyle=`rgba(255,0,0,${1-(this.dying||0)})`,t.shadowBlur=5,this.dying?(t.save(),t.translate(Math.round(this.at[0])-this.radius,Math.round(this.at[1]-this.radius)),t.rotate(this.dying*Math.PI),t.scale(1-this.dying,1-this.dying),t.fillRect(-this.radius,-this.radius,2*this.radius,2*this.radius),t.restore()):(t.beginPath(),t.arc(this.at[0],this.at[1],this.radius,0,2*Math.PI),t.stroke(),t.fill()),t.shadowBlur=0}move(){if(this.dying)return this.dying+=.05,!(this.dying>1);let t=e(this.at,this.speed);return(t[0]<100||t[0]>=this.game.width-100)&&(this.speed[0]=-this.speed[0],t[1]+=20),this.at=t,this.at[1]<=this.game.height-100}destroy(){this.dying=.01,new c(this.game,this.at),console.log(this.at)}}class g{constructor(t){this.dots=[],this.lineLength=0,Object.assign(this,t)}enlarge(t){let s=this.dots;for(this.lineLength=this.lineLength||0,s.length>0&&(this.lineLength+=i(this.head,t)),s.push(t);this.lineLength>this.maxLength||s.length>30;)this.lineLength-=i(s[0],s[1]),s.shift();let e=s.reduce((t,e,a)=>0==a?0:t+i(s[a-1],e),0);console.assert(Math.abs(this.lineLength-e)<1)}compact(t,s){for(;t.dots.length>=3&&i(t.head,t.dots[t.dots.length-2])<=s;)t.dots.splice(t.dots.length-2,1)}get head(){return this.dots[this.dots.length-1]}draw(s,e){let i=this.dots;for(let a=1;a<i.length;a++){let h=i[a],n=i[a-1];s.beginPath(),s.moveTo(...t(n)),s.lineCap="round",e(this,a),s.lineTo(...t(h)),s.stroke()}}}const u=30,m=5;let w,p=2;class v{constructor(t,s){this.game=t,this.bounces=0,this.tail=new g({dots:[e(s,[0,20])],speed:[0,p],maxLength:u,maxDots:m})}move(){let t=this.tail,s=t.head;if(s[0]<0||s[1]<0||s[0]>this.game.width||s[1]>this.game.height)return!1;let h=e(s,t.speed),n=a(this.game.foes,t=>i(t.at,s)),r=a(this.game.snake.tail.dots,t=>i(t,s)),l=!1;if(n.val>20&&r.val>20)t.enlarge(h);else{let s=this.game.ctx.getImageData(h[0],h[1],1,1);if(255==s.data[3]){if(255==s.data[0]&&0==s.data[1]&&0==s.data[2]&&this.bounces>0)return n.item.destroy(),!1;if(255==s.data[2]){l=!0;let e=[s.data[0],s.data[1]].map(t=>t/100-1.5);o(this.tail.head);let i=2*Math.atan2(e[1],e[0])+Math.atan2(t.speed[1],t.speed[0])+Math.PI;t.speed=[Math.cos(i),Math.sin(i)].map(t=>t*p)}}t.enlarge(h),l&&(t.enlarge(e(h,t.speed,1.5)),this.bounces++)}return!0}draw(){let t=this.game.ctx;this.tail.draw(t,(s,e)=>{t.lineWidth=2;let i=Math.min(230,e/this.tail.dots.length*200);t.strokeStyle=`rgb(${i},${i},${i})`});let s=this.tail.head;t.strokeStyle="#fdfdfd",t.fillStyle="#fdfdfd",t.fillRect(s[0]-1,s[1],2,2)}}class b{constructor(t){this.game=t,this.tail=new g({maxLength:80,maxDots:30})}move(t){this.tail.enlarge(t)}draw(){this.tail.draw(this.game.ctx,(t,s)=>{let e=[0,1].map(e=>t.dots[s][e]-t.dots[s-1][e]),a=i(e);e=[e[0]/a,e[1]/a];let h=[0,1].map(t=>Math.floor(150+Math.floor(100*e[t])));this.game.ctx.lineWidth=s/4+5,this.game.ctx.strokeStyle=`rgb(${h[0]},${h[1]},255)`})}get head(){return this.tail.head}}class y{constructor(){this.scale=2,this.realtime=!1}init(){this.canvas=document.getElementById("canvas-main"),this.background=document.getElementById("canvas-background"),this.ctx=this.canvas.getContext("2d"),this.ctb=this.background.getContext("2d"),this.ctx.strokeStyle="white",this.width=this.canvas.clientWidth/this.scale,this.height=this.canvas.clientHeight/this.scale,this.canvas.height=this.height,this.canvas.width=this.width,this.background.height=this.height,this.background.width=this.width,this.snake=new b(this),this.shots=[],this.foes=[],this.sfx=[],this.startLoop(),this.spawnFoe()}loop(){let t=this.mouseAt&&i(this.mouseAt,this.snake.head)>=5;if(this.realtime||t){t&&this.snake.move(this.mouseAt),this.foes.length<=10&&Math.random()<.02&&this.spawnFoe();for(let t of this.foes)if(Math.random()<.02){let s=new v(this,t.at);this.shots.push(s)}(this.realtime||t)&&(this.shots=this.shots.filter(t=>t.move()),this.foes=this.foes.filter(t=>t.move()),this.sfx=this.sfx.filter(t=>t.move()),this.draw())}}startLoop(){this.canvas.addEventListener("mousemove",t=>{this.mouseAt=[(t.pageX-this.canvas.offsetLeft)/this.scale,(t.pageY-this.canvas.offsetTop)/this.scale]},!1),function t(s){s(),requestAnimationFrame(e=>t(s))}(this.loop.bind(this)),this.canvas.addEventListener("mousedown",t=>{console.log(this),this.realtime=!this.realtime})}spawnFoe(){this.foes.push(new f(this,{at:[this.width*(.5*Math.random()+.25),20],speed:[2,0]}))}draw(){this.ctx.clearRect(0,0,this.width,this.height),this.ctb.clearRect(0,0,this.width,this.height),this.ctx.shadowColor="white";for(let t of this.shots)t.draw();for(let t of this.foes)t.draw();for(let t of this.sfx)t.draw();this.snake.draw()}}window.onload=function(){(w=new y).init()}}();
//# sourceMappingURL=bundle.js.map
