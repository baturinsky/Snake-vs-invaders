!function(){"use strict";var t=new AudioContext;let e,n,a,o,l,i,d,r=2;const s=30,f=5;function u(t){return t.dots[t.dots.length-1]}function h(t){return[Math.round(t[0]),Math.round(t[1])]}function c(t,e){let n=t.reduce((t,n,a)=>{let o=e(n);return o<t[1]?[a,o]:t},[-1,1e9]);return n[0]<0?{ind:-1,item:null,val:null}:{ind:n[0],item:t[n[0]],val:e(t[n[0]])}}function g(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function m(t,e,n=1){return[t[0]+e[0]*n,t[1]+e[1]*n]}function p(t,e){return g(e?[t[0]-e[0],t[1]-e[1]]:t)}function M(t,e){let n=t.dots;for(t.lineLength=t.lineLength||0,n.length>0&&(t.lineLength+=p(u(t),e)),n.push(e);t.lineLength>t.maxLength||n.length>30;)t.lineLength-=p(n[0],n[1]),n.shift();let a=n.reduce((t,e,a)=>0==a?0:t+p(n[a-1],e),0);console.assert(Math.abs(t.lineLength-a)<1)}function v(t,e){let n=t.dots;for(let a=1;a<n.length;a++){let o=n[a],l=n[a-1];d.beginPath(),d.moveTo(...h(l)),d.lineCap="round",e(t,a),d.lineTo(...h(o)),d.stroke()}}function L(t){let e=m(t.at,t.speed);return(e[0]<100||e[0]>=o-100)&&(t.speed[0]=-t.speed[0],e[1]+=20),t.at=e,t.at[1]<=l-100}function y(n){let i=n.tail,s=u(i);if(s[0]<0||s[1]<0||s[0]>o||s[1]>l)return!1;let f=m(s,i.speed),h=c(a,t=>p(t.at,s)),g=c(e.dots,t=>p(t,s)),v=!1;if(h.val>20&&g.val>40)M(i,f);else{let e=d.getImageData(f[0],f[1],1,1);if(255==e.data[3]){if(255==e.data[0]&&0==e.data[1]&&0==e.data[2]&&n.bounces>0)return a.splice(h.ind,1),!1;if(255==e.data[2]){v=!0;let n=[e.data[0],e.data[1]].map(t=>t/100-1.5),a=t.createOscillator();a.type="sawtooth",a.frequency.value=200;let o=t.createGain();o.gain.value=.1,o.gain.exponentialRampToValueAtTime(1e-5,t.currentTime+.1),a.connect(o).connect(t.destination),a.start(),setTimeout(t=>{a.stop()},50);let l=2*Math.atan2(n[1],n[0])+Math.atan2(i.speed[1],i.speed[0])+Math.PI;i.speed=[Math.cos(l),Math.sin(l)].map(t=>t*r)}}M(i,f),v&&(M(i,m(f,i.speed,1.5)),n.bounces++)}return!0}function x(){a.push({at:[o*(.5*Math.random()+.25),20],speed:[2,0]})}window.onload=function(){i=document.getElementById("canvas"),(d=i.getContext("2d")).strokeStyle="white";o=i.clientWidth/2,l=i.clientHeight/2,i.height=l,i.width=o,e={dots:[],maxLength:80,maxDots:30},n=[],a=[],x(),i.addEventListener("mousemove",t=>{let h=[(t.pageX-i.offsetLeft)/2,(t.pageY-i.offsetTop)/2];(0==e.dots.length||p(h,u(e))>=5)&&(function(t){M(e,t),a.length<=10&&Math.random()<.02&&x();for(let t of a)if(Math.random()<.02){let e={tail:{dots:[m(t.at,[0,20])],maxLength:s,maxDots:f,speed:[0,r]},bounces:0};n.push(e)}}(h),n=n.filter(y),a=a.filter(L),function(){d.clearRect(0,0,o,l);for(let t of n){v(t.tail,(e,n)=>{d.lineWidth=2;let a=Math.min(230,n/t.tail.dots.length*200);d.strokeStyle=`rgb(${a},${a},${a})`});let e=u(t.tail);d.strokeStyle="#fdfdfd",d.fillStyle="#fdfdfd",d.fillRect(Math.round(e[0])-1,Math.round(e[1])-1,2,2)}for(let t of a)d.strokeStyle="#ff0000",d.fillStyle="#ff0000",d.fillRect(Math.round(t.at[0])-10,Math.round(t.at[1]-10),20,20);v(e,(t,e)=>{let n=[0,1].map(n=>t.dots[e][n]-t.dots[e-1][n]),a=p(n);n=[n[0]/a,n[1]/a];let o=[0,1].map(t=>Math.floor(150+Math.floor(100*n[t])));d.lineWidth=e/4+5,d.strokeStyle=`rgb(${o[0]},${o[1]},255)`})}())},!1),i.addEventListener("mousedown",t=>{console.log(n)})}}();
//# sourceMappingURL=bundle.js.map
