!function(){"use strict";function t(t){return[Math.round(t[0]),Math.round(t[1])]}function s(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function e(t,s,e=1){return[t[0]+s[0]*e,t[1]+s[1]*e]}function i(t,e){return s(e?[t[0]-e[0],t[1]-e[1]]:t)}function h(t,s){let e=t.reduce((t,e,i)=>{let h=s(e);return h<t[1]?[i,h]:t},[-1,1e9]);return e[0]<0?{ind:-1,item:null,val:null}:{ind:e[0],item:t[e[0]],val:s(t[e[0]])}}class a{}const n=100;class o{constructor(t,s){this.game=t,this.life=0,this.particles=[];for(let t=0;t<30;t++){let e=new a;this.particles.push(e),e.at=[s[0],s[1]];let i=t/30*Math.PI*2+.1*Math.random(),h=Math.random();e.speed=[Math.cos(i)*h,Math.sin(i)*h]}t.sfx.push(this)}move(){for(let t of this.particles)t.at=e(t.at,t.speed);return this.life++,this.life<=n}draw(){let t=this.game.ctb;t.lineWidth=2,t.fillStyle=`rgba(255, 0, 0, ${1-this.life/n})`;for(let s of this.particles)t.fillRect(s.at[0],s.at[1],4,4)}}class l{constructor(t,s){this.game=t,this.radius=10,Object.assign(this,s)}draw(){let t=this.game.ctx;t.strokeStyle="#ff0000",t.fillStyle=`rgba(255,0,0,${1-(this.dying||0)})`,t.shadowBlur=5,this.dying?(t.save(),t.translate(Math.round(this.at[0])-this.radius,Math.round(this.at[1]-this.radius)),t.rotate(this.dying*Math.PI),t.scale(1-this.dying,1-this.dying),t.fillRect(-this.radius,-this.radius,2*this.radius,2*this.radius),t.restore()):(t.beginPath(),t.arc(this.at[0],this.at[1],this.radius,0,2*Math.PI),t.stroke(),t.fill()),t.shadowBlur=0}move(){if(this.dying)return this.dying+=.05,!(this.dying>1);let t=e(this.at,this.speed);return(t[0]<100||t[0]>=this.game.width-100)&&(this.speed[0]=-this.speed[0],t[1]+=20),this.at=t,this.at[1]<=this.game.height-100}destroy(){this.dying=.01,new o(this.game,this.at),console.log(this.at)}}class r{constructor(t){this.dots=[],this.lineLength=0,Object.assign(this,t)}enlarge(t){let s=this.dots;for(this.lineLength=this.lineLength||0,s.length>0&&(this.lineLength+=i(this.head,t)),s.push(t);this.lineLength>this.maxLength||s.length>30;)this.lineLength-=i(s[0],s[1]),s.shift();let e=s.reduce((t,e,h)=>0==h?0:t+i(s[h-1],e),0);console.assert(Math.abs(this.lineLength-e)<1)}compact(t,s){for(;t.dots.length>=3&&i(t.head,t.dots[t.dots.length-2])<=s;)t.dots.splice(t.dots.length-2,1)}get head(){return this.dots[this.dots.length-1]}draw(s,e){let i=this.dots;for(let h=1;h<i.length;h++){let a=i[h],n=i[h-1];s.beginPath(),s.moveTo(...t(n)),s.lineCap="round",e(this,h),s.lineTo(...t(a)),s.stroke()}}}const d=30,c=5;let g,u=2,f=new AudioContext;class m{constructor(t,s){this.game=t,this.bounces=0,this.tail=new r({dots:[e(s,[0,20])],speed:[0,u],maxLength:d,maxDots:c})}move(){let t=this.tail,s=t.head;if(s[0]<0||s[1]<0||s[0]>this.game.width||s[1]>this.game.height)return!1;let a=e(s,t.speed),n=h(this.game.foes,t=>i(t.at,s)),o=h(this.game.snake.tail.dots,t=>i(t,s)),l=!1;if(n.val>20&&o.val>20)t.enlarge(a);else{let s=this.game.ctx.getImageData(a[0],a[1],1,1);if(255==s.data[3]){if(255==s.data[0]&&0==s.data[1]&&0==s.data[2]&&this.bounces>0)return n.item.destroy(),!1;if(255==s.data[2]){l=!0;let e=[s.data[0],s.data[1]].map(t=>t/100-1.5),i=f.createOscillator();i.type="sawtooth",i.frequency.value=200;let h=f.createGain();h.gain.value=.1,h.gain.exponentialRampToValueAtTime(1e-5,f.currentTime+.1),i.connect(h).connect(f.destination),i.start(),setTimeout(t=>{i.stop()},50);let a=2*Math.atan2(e[1],e[0])+Math.atan2(t.speed[1],t.speed[0])+Math.PI;t.speed=[Math.cos(a),Math.sin(a)].map(t=>t*u)}}t.enlarge(a),l&&(t.enlarge(e(a,t.speed,1.5)),this.bounces++)}return!0}draw(){let t=this.game.ctx;this.tail.draw(t,(s,e)=>{t.lineWidth=2;let i=Math.min(230,e/this.tail.dots.length*200);t.strokeStyle=`rgb(${i},${i},${i})`});let s=this.tail.head;t.strokeStyle="#fdfdfd",t.fillStyle="#fdfdfd",t.fillRect(s[0]-1,s[1],2,2)}}class w{constructor(t){this.game=t,this.tail=new r({maxLength:80,maxDots:30})}move(t){this.tail.enlarge(t)}draw(){this.tail.draw(this.game.ctx,(t,s)=>{let e=[0,1].map(e=>t.dots[s][e]-t.dots[s-1][e]),h=i(e);e=[e[0]/h,e[1]/h];let a=[0,1].map(t=>Math.floor(150+Math.floor(100*e[t])));this.game.ctx.lineWidth=s/4+5,this.game.ctx.strokeStyle=`rgb(${a[0]},${a[1]},255)`})}get head(){return this.tail.head}}class p{constructor(){this.scale=2,this.realtime=!0}init(){this.canvas=document.getElementById("canvas-main"),this.background=document.getElementById("canvas-background"),this.ctx=this.canvas.getContext("2d"),this.ctb=this.background.getContext("2d"),this.ctx.strokeStyle="white",this.width=this.canvas.clientWidth/this.scale,this.height=this.canvas.clientHeight/this.scale,this.canvas.height=this.height,this.canvas.width=this.width,this.background.height=this.height,this.background.width=this.width,this.snake=new w(this),this.shots=[],this.foes=[],this.sfx=[],this.startLoop(),this.spawnFoe()}loop(){let t=this.mouseAt&&i(this.mouseAt,this.snake.head)>=5;if(this.realtime||t){t&&this.snake.move(this.mouseAt),this.foes.length<=10&&Math.random()<.02&&this.spawnFoe();for(let t of this.foes)if(Math.random()<.02){let s=new m(this,t.at);this.shots.push(s)}(this.realtime||t)&&(this.shots=this.shots.filter(t=>t.move()),this.foes=this.foes.filter(t=>t.move()),this.sfx=this.sfx.filter(t=>t.move()),this.draw())}}startLoop(){this.canvas.addEventListener("mousemove",t=>{this.mouseAt=[(t.pageX-this.canvas.offsetLeft)/this.scale,(t.pageY-this.canvas.offsetTop)/this.scale]},!1),function t(s){s(),requestAnimationFrame(e=>t(s))}(this.loop.bind(this)),this.canvas.addEventListener("mousedown",t=>{console.log(this),this.realtime=!this.realtime})}spawnFoe(){this.foes.push(new l(this,{at:[this.width*(.5*Math.random()+.25),20],speed:[2,0]}))}draw(){this.ctx.clearRect(0,0,this.width,this.height),this.ctb.clearRect(0,0,this.width,this.height),this.ctx.shadowColor="white";for(let t of this.shots)t.draw();for(let t of this.foes)t.draw();for(let t of this.sfx)t.draw();this.snake.draw()}}window.onload=function(){(g=new p).init()}}();
//# sourceMappingURL=bundle.js.map
